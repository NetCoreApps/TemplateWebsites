<!--
title: Search Customers
-->

{{ limit | otherwise(20) | assignTo: limit }}

<a id="back" href="../../../">&#8592; Home</a>

<form class="form-inline">
    <label class="mr-sm-2" for="country">Country</label>
    <select class="custom-select mb-2 mr-sm-2 mb-sm-0" name="country" id="country">
        <option value=""></option>
        {{ "select distinct Country from customer" | dbSelect | select: <option {'selected' | if(eq(country, it.Country))}>{ it.Country }</option> }}
    </select>
    <label class="mr-sm-2" for="city">City</label>
    <select class="custom-select mb-2 mr-sm-2 mb-sm-0" name="city" id="city">
        <option value=""></option>
        {{ "select distinct City from customer" | dbSelect | select: <option {'selected' | if(eq(city, it.City))}>{ it.City }</option> }}
    </select>

    <label class="mr-sm-2" for="country">Limit</label>
    <input type="text" name="limit" class="form-control col-1 mb-2 mr-sm-2 mb-sm-0" value="{{ limit }}">

    <button type="submit" class="btn btn-primary">Submit</button>
</form>

{{ "select id,companyName,contactName,contactTitle,city,country from customer" | assignTo: sql }}

{{ [truthy(country, "country = @country"), truthy(city, "city = @city")] | where: !isNull(it) 
   | join(" and ") | assignTo: filters }}
{{ sql | appendFmt(' where {0}', filters) | if(greaterThan(filters.Length, 0)) | otherwise(sql) | assignTo: sql }}

{{ "table table-striped details" | assignTo: className }}
{{ sql | appendFmt(' limit {0}', limit) | assignTo: sql }}
{{ sql | dbSelect({ country, city }) | htmltable({ className }) }}

<style>
    .details tbody tr:hover {
        cursor: pointer;
        background: #FFF9C4 !important;
    }
</style>

{{ `<script>
$('.details tbody tr').on('click', function(){
    var id = $(this).find("td:first").html();
    location.href = 'customer?id=' + id;
})
</script>` | raw | assignTo: scripts }}

